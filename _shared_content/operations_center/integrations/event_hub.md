#### Overview

Azure Event Hubs is a cloud-based event streaming platform and event ingestion service provided by Microsoft Azure. It is designed to handle large amounts of event data generated by various applications, devices, and services in real-time. Event Hubs enables you to ingest, process, and store events, logs, telemetry data, and other streaming data for further analysis, monitoring, and processing.

This setup guide will show you how to create an Event Hub and forward events from this Event Hub to Sekoia.io.

Theses changes have to be made from the [Azure Web Portal](https://portal.azure.com).

As a prerequisite, you need to choose an existing “resource group”, or create a new one (e.g. `company-resource-group`).

#### Step 1: Retrieve your Subscription ID

If you don't have a default one, in Azure Web Portal, go to: "Home" -  "Cost Management + Billing" - "Subscriptions". 

From there, keep the relevant “Subscription ID” that will be used along the process (e.g. `uuid`).

#### Step 2: Create Event Hub Namespace and associated Event Hub

Navigate to “Home”, “Event Hubs”. Create an Event Hub Namespace. 
Select your Subscription and your Resource Group.

When your Event Hub Namespace is created you can create an Event Hub inside 
Navigate to “Home”, “Event Hubs”, “company-eventhubnamespace". Create an Event Hub. 

#### Step 3: Create “Shared Access Policies” for the Event Hub Namespace 

Navigate to “Home”, “Event Hubs”, “company-eventhubnamespace - Shared access policies”. 

From there, you can create a policy (e.g. `RootManageSharedAccessKey`) with the claims `Manage`, `Send` and `Listen`.

#### Step 4: Create “Shared Access Policies” for the Event Hub 

Navigate to “Home”, “Event Hubs”, “company-eventhubnamespace”, “eventhubname - Shared access policies”. 

From there, you can create a policy (e.g. `sekoiaio`) with the claims `Listen`. 

Once created, click on the policy.

!!! info
    Carefully store the Connection String that will be used for sekoia playbook configuration.
    

#### Step 5: Create a Consumer group
   
Navigate to “Home”, “Event Hubs”, “company-eventhubnamespace”, ”“eventhubname - Consumer groups”. 

From there, you can create a consumer group (e.g. `consumergroup_sekoiaio`).


#### Step 6: Create a Blob Storage for Checkpointing

In order to allow Sekoia.io keep track of the consumed events, the next step consists in creating a dedicated Azure Blob Storage.

Navigate to “Home”, “Storage accounts”. 
From there, you can create a storage account.
Select your Subscription and your Resource Group.

When your storage account is created you can create an container inside 
Navigate to “Home”, “Storage accounts”, “storageaccoutname - containers". 
Create an container. 

!!! info
    The container name should be the same as the Event Hub name.

#### Step 7: Retrieve Connection String

You have to retrieve the connection string from Azure Web Portal.

Go to “Storage Accounts”, "“storageaccoutname", "Access Keys". 

Click on "Show Keys" on the first Connection String. 
![Connection String](https://github.com/jdpju/documentation/assets/113444861/dc6e176c-ac19-46d4-a65a-b97a1331a2d8){: style="max-width:100%"}

!!! info
    Carefully store the Connection String that will be used for sekoia playbook configuration.

#### Further Readings

- [Microsoft Create an event hub using Azure portal](https://learn.microsoft.com/en-us/azure/event-hubs/event-hubs-create)
